## 概述


## 数据结构与设计思想

### 情报数据结构（schema）

```python
from typing import Dict, Any
from pydantic import BaseModel, Field

class ProcessedData(BaseModel):
    """Structured intelligence data extracted and validated from LLM output."""
    TAXONOMY:      str                    = Field(...)                   # High-level category (e.g., 'Politics', 'NonIntelligence'). Dynamic string.
    SUB_CATEGORY:  list[str] | None       = Field(default_factory=list)  # Specific tags selected from the prompt list (e.g., ['International Relations']). Dynamic list.
    REASON:        str | None             = Field(None)                  # Explanation for the classification (Used for both Valuable and Non-Intelligent items).
    EVENT_TITLE:   str | None             = Field(None, min_length=1)    # Core title of the intelligence event (<20 chars).
    EVENT_BRIEF:   str | None             = Field(None, min_length=1)    # Factual summary of the event (<50 chars).
    EVENT_TEXT:    str | None             = Field(None)                  # Detailed intelligence report/briefing generated by LLM (>2000 chars if content allows).
    TIME:          list[str] | None       = Field(default_factory=list)  # Standardized event dates extracted from text (Format: YYYY-MM-DD).
    LOCATION:      list[str] | None       = Field(default_factory=list)  # Specific locations mentioned (Cities, Regions).
    GEOGRAPHY:     str | None             = Field(None)                  # Country ISO code (e.g., 'CN', 'US') or English name.
    PEOPLE:        list[str] | None       = Field(default_factory=list)  # Key individuals involved.
    ORGANIZATION:  list[str] | None       = Field(default_factory=list)  # Key organizations or groups involved.
    IMPACT:        str | None             = Field(None)                  # Brief description of the event's impact (<50 chars).
    RATE:          dict[str, int] | None  = Field(default_factory=dict)  # Scoring dictionary (1-10) for dimensions like Impact, Novelty, Actionability.
    TIPS:          str | None             = Field(None)                  # Analyst remarks or handling difficulties.


class ArchivedDataExtraFields(BaseModel):
    """Additional fields appended during the persistence layer (Database insertion)."""
    UUID:      str                    = Field(..., min_length=1)   # [MUST] Unique identifier for the message/article.
    INFORMANT: str                    = Field(..., min_length=1)   # [MUST] The specific source URL or informant ID.
    RAW_DATA:  Dict[str, Any] | None  = Field(None)                # The full raw original message.
    SUBMITTER: str | None             = Field(None)                # Where the intelligence comes from.
    APPENDIX:  Dict[str, Any] | None  = Field(None)                # Any extra metadata, file attachments, or extended properties.


class ArchivedData(ProcessedData, ArchivedDataExtraFields):
    """Final model representing a record stored in the database."""
    pass
```


### 字段的设计思想

+ 领域和评分分离
  > 和v1版本相比，v2版本最大的调整在于将情报分类和评分分离。
  > 
  > TAXONOMY 为情报主领域分类， SUB_CATEGORY 为情报相关的子领域标签。
  >
  > 对于任一情报，只能归属于一个主领域分类，但子领域标签可以有多个。
  > 
  > RATE 为评分字段，当前我的设计是从通用的维度（影响广度、影响深度、新颖性与异常性、演化与连锁潜力、舆情及认知影响、可行动性）评分并通过不同权重计算总分。
  > 
  > **注意：无论是情报分类还是评分，我都没有做任何限制。大家完全可以根据自己的需求，将具体应用场景的分类和评分维度加入到这个框架中。**
  > 
  > 提供一个情报结构化表示的“通用框架”，正是v2设计的核心思想。正因这种设计，v1版本的评分体系对v2来说也是完全没问题的。

+ 保留五要素提取，同时独立将地域信息提取出来
  > 五要素即：时间、地点、人物、组织、事件。
  > 
  > 其中事件体现在 EVENT_TITLE、EVENT_BRIEF、EVENT_TEXT 字段中，以不同精度对事件进行概述或描述。这几个字段通过向量化和向量数据库进行索引、关联和查找。
  > 
  > 时间、地址、地点、组织分别体现在 TIME、LOCATION、PEOPLE、ORGANIZATION 字段中。在我的设计中，它们是事件内容向量化之外另一套关联和索引的方法。
  > 
  > GEOGRAPHY 字段特意将地域信息从 LOCATION 中提取出来，（建议）以标准形式存储（如国家ISO代码：CN, US），用来快速过滤和关注特定国家的情报和政策。
  > 

+ 让AI阐述其分析的逻辑以及给出建议
  > 为了让人类更好地理解AI分析的逻辑，以及让小模型更好地学习大模型的“想法”，情报中还包括 REASON 和 TIPS 字段，用以在结构化数据之外让AI“表达”。
  > 
  > REASON 用来让AI阐述它分析的理由。
  > 
  > TIPS 则是让AI给出建议或进行更自由的陈述。

+ 附加数据与定制化数据
  > ArchivedDataExtraFields 描述了附加数据，即“情报内容”之外的“元数据”
  > 
  > UUID - 情报的唯一标识，毫无疑问是必须的。
  > 
  > INFORMANT - 信源，通常是URL。理论上可以是任何内容，但为了避免混乱，当前暂时限制为URL。
  > 
  > RAW_DATA - 原始采集到的数据，即 CollectedData 结构。
  > 
  > SUBMITTER - 情报的提交者，预留。
  > 
  > APPENDIX - 任何其它信息，包括附加信息、临时信息、自定义信息。IIS中定义并使用了一些字段，这些字段有特定用途，但和情报本身本身无关：
  > 
  > ```python
  > APPENDIX_TIME_PUB           = '__TIME_PUB__'            # Timestamp of article published
  > APPENDIX_TIME_GOT           = '__TIME_GOT__'            # Timestamp of get from collector
  > APPENDIX_TIME_POST          = '__TIME_POST__'           # Timestamp of post to processor
  > APPENDIX_TIME_DONE          = '__TIME_DONE__'           # Timestamp of retrieve from processor
  > APPENDIX_TIME_ARCHIVED      = '__TIME_ARCHIVED__'
  > 
  > APPENDIX_ARCHIVED_FLAG      = '__ARCHIVED__'
  > 
  > APPENDIX_TOTAL_SCORE        = '__TOTAL_SCORE__'
  > APPENDIX_MANUAL_RATING      = '__MANUAL_RATING__'
  > 
  > APPENDIX_PROMPT_VERSION     = '__PROMPT_VERSION__'
  > APPENDIX_AI_SERVICE         = '__AI_SERVICE__'
  > APPENDIX_AI_MODEL           = '__AI_MODEL__'
  > 
  > # APPENDIX_LINK_UPSTREAM      = '__LINK_UPSTREAM__'
  > # APPENDIX_LINK_DOWNSTREAM    = '__LINK_DOWNSTREAM__'
  > 
  > APPENDIX_VECTOR_SCORE       = '__VECTOR_SCORE__'        # Temporary added when doing vector search
  > ```

### 设计时对于训练的考虑

v2版本除了提供更完善通用的情报数据结构框架外，还考虑了模型训练的需求，体现在以下设计：

1. 无价值信息不直接丢弃，而是遵循同样的基本结构，作为训练时的负例。
2. 分析结果都会包含 REASON 字段，用以阐述评分理由，体现了大模型的逻辑，对训练（可能）有帮助。
3. 分析使用相似的多套prompt，避免训练时将prompt变成“功能开关”，这种设计（可能）让小训练后的小模型泛化性能更好。
4. APPENDIX 中包含更多信息，可以通过 __PROMPT_VERSION__、__AI_SERVICE__、__AI_MODEL__ 等字段来均衡或加强训练集中某类分析结果的权重。

